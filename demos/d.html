<html>

<head>
  <title>demos</title>
  <script src="../components/tiledemos/demoholder.js" type="module"></script>
  <script src="../components/tiledemos/twobitvideotiles.js" type="module"></script>
  <script src="../components/tiledemos/palettepick.js" type="module"></script>
  <style>
    body {
      background-color: gray;
    }

    two-bit-video-tiles {
      position: absolute;
      width: 98%;
      height: 96%;
    }

    tile-palette-pick {
      position: absolute;
      width: 98%;
      height: 96%;
      transform: scale(0.01);
    }

    .tile-grow {
      animation: 1s grow-tile;
      animation-fill-mode: forwards;
    }

    @keyframes grow-tile {
      from {
        transform: scale(0.01);
      }

      to {
        transform: scale(1);
      }
    }

    .vid-move {
      animation: 1s move-vid;
      animation-fill-mode: forwards;
    }

    @keyframes move-vid {
      from {
        transform: translateX(0);
      }

      to {
        transform: translateX(-50%);
      }
    }
  </style>
</head>

<body>
  <demo-holder>
    <two-bit-video-tiles></two-bit-video-tiles>
    <tile-palette-pick hidden></tile-palette-pick>
  </demo-holder>
  <div id="buttons"></div>
  <!--button id="1">play</button>
  <button id="9">fade in</button>
  <button id="2">explode</button>
  <button id="3">unexplode</button>
  <button id="4">move</button>
  <button id="5">grow</button>
  <button id="6">tile grid</button>
  <button id="7">colours</button>
  <button id="8">palette</button-->
  <script defer>
    function scene(name, fn, f = null) {
      return { name, fn, f};
    }
    const b = [];
    for (let i = 1; i <= 9; ++i) {
      b[i] = document.getElementById(i);
    }
    const vid = document.querySelector('two-bit-video-tiles');
    const tile = document.querySelector('tile-palette-pick');

    const timed_scenes = [
      scene('fade in', () => vid.fadeIn(), 150/2),
      scene('explode', () => vid.explode(), 540/2),
      scene('unexplode', () => vid.deExplode(), 630/2),
      scene('move', () => vid.moveTile(), 720/2),
      scene('grow', () => {
        tile.removeAttribute('hidden');
        tile.className = 'tile-grow';
      }, 800/2),
      scene('tile grid', () => tile.showGrid(), 820/2),
      scene('colour numbers', () => tile.showColourNumbers(), 1800/2),
      scene('colours', () => {
        tile.setPalette([0, 0, 0, 0]);
        tile.draw4Colours();
        tile.showColours();
      }, 2080/2),
      scene('hide colour Numbers', () => tile.hideColourNumbers(), 2200/2),
      scene('palette', () => {
        vid.style.zIndex = '-1';
        tile.showPalette();
        vid.hideTile();
      }),
    ];

    const scenes = [
      scene('play', () => vid.play()),
      ...timed_scenes
    ];
    vid.addEventListener('ready', () => {
      //vid.frameCallbacks.set(60, scenes[1].fn);
      for (const s of timed_scenes) {
        if (!s.f) continue;
        vid.frameCallbacks.set(s.f, s.fn);
      }
    });
    const buttonContainer = document.getElementById('buttons');
    for (const s of scenes) {
      const button = document.createElement('button');
      button.innerText = s.name;
      button.addEventListener('click', s.fn);
      buttonContainer.appendChild(button);
    }
    tile.addEventListener('palette-change', (ev) => {
      vid.setColours(ev.detail);
    });

  </script>
</body>

</html>